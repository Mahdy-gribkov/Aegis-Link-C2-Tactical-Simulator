<Window x:Class="AegisLink.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:AegisLink.App.Views"
        Title="AEGIS-LINK | TACTICAL C2 CONSOLE" Height="800" Width="1400"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        WindowStartupLocation="CenterScreen" 
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        KeyDown="Window_KeyDown">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <DataTemplate x:Key="DashboardTemplate">
                <views:DashboardView/>
            </DataTemplate>
            <DataTemplate x:Key="RadarTemplate">
                <views:RadarView/>
            </DataTemplate>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="#E6050505" CornerRadius="10" BorderBrush="#00FFFF" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="2"/>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="25"/>
            </Grid.RowDefinitions>

            <!-- Scanline Overlay -->
            <Canvas Grid.RowSpan="5" IsHitTestVisible="False" Opacity="0.03">
                <Rectangle x:Name="ScanlineBar" Width="2000" Height="2" Fill="#00FF00" Canvas.Top="0"/>
            </Canvas>

            <!-- Power Line -->
            <Border Grid.Row="0" Background="#00FFFF" CornerRadius="10,10,0,0"/>

            <!-- Custom Title Bar -->
            <Border Grid.Row="1" Background="#0A0A0A" MouseDown="TitleBar_MouseDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0">
                        <TextBlock Text="◢ AEGIS-LINK" FontSize="16" FontWeight="Bold" Foreground="#00FFFF" FontFamily="Consolas"/>
                        <TextBlock Text=" | PHOENIX v2.1.0" FontSize="12" Foreground="#666666" Margin="10,0,0,0" VerticalAlignment="Center"/>
                        <TextBlock Text=" | " Foreground="#333333" Margin="10,0"/>
                        <TextBlock Text="{Binding MissionClock}" FontSize="12" Foreground="#FFB000" FontFamily="Consolas" VerticalAlignment="Center"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,10,0">
                        <Button Content="─" Width="30" Height="25" Background="Transparent" Foreground="#888888" BorderThickness="0" Click="Minimize_Click" FontFamily="Consolas"/>
                        <Button Content="□" Width="30" Height="25" Background="Transparent" Foreground="#888888" BorderThickness="0" Click="Maximize_Click" FontFamily="Consolas"/>
                        <Button Content="✕" Width="30" Height="25" Background="Transparent" Foreground="#FF4444" BorderThickness="0" Click="Close_Click" FontFamily="Consolas"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Dynamic Content Area -->
            <ContentControl Grid.Row="2" Content="{Binding}" ContentTemplate="{Binding CurrentViewTemplate}"/>

            <!-- Sliding Terminal -->
            <Border Grid.Row="3" Background="#0A0A0A" BorderBrush="#333333" BorderThickness="0,1,0,0" 
                    Visibility="{Binding TerminalVisibility}">
                <Grid Height="150">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="30"/>
                    </Grid.RowDefinitions>

                    <ListBox Grid.Row="0" ItemsSource="{Binding CommandLog}" 
                             Background="Transparent" BorderThickness="0" 
                             Foreground="#00FF00" FontFamily="Consolas" FontSize="11" Margin="10,5">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="0,1"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>

                    <Grid Grid.Row="1" Margin="10,0,10,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="AEGIS&gt; " Foreground="#00FFFF" FontFamily="Consolas" VerticalAlignment="Center"/>
                        <TextBox x:Name="CommandInput" Grid.Column="1" Background="#0A0A0A" Foreground="#00FF00" 
                                 BorderThickness="0" FontFamily="Consolas" VerticalAlignment="Center"
                                 KeyDown="CommandInput_KeyDown"/>
                    </Grid>
                </Grid>
            </Border>

            <!-- Status Bar -->
            <Border Grid.Row="4" Background="#080808" CornerRadius="0,0,10,10">
                <Grid Margin="15,0">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Ellipse x:Name="RxIndicator" Width="6" Height="6" Fill="#333333" Margin="0,0,5,0"/>
                        <TextBlock Text="RX" FontSize="9" Foreground="#444444" FontFamily="Consolas" Margin="0,0,15,0"/>
                        <Ellipse x:Name="TxIndicator" Width="6" Height="6" Fill="#333333" Margin="0,0,5,0"/>
                        <TextBlock Text="TX" FontSize="9" Foreground="#444444" FontFamily="Consolas"/>
                    </StackPanel>
                    <TextBlock Text="{StaticResource SystemStatus}" FontSize="9" Foreground="#444444" VerticalAlignment="Center" HorizontalAlignment="Center" FontFamily="Consolas"/>
                    <TextBlock Text="OPERATOR: M. GRIBKOV | [~] Terminal | [F11] Fullscreen" FontSize="9" Foreground="#444444" HorizontalAlignment="Right" VerticalAlignment="Center" FontFamily="Consolas"/>
                </Grid>
            </Border>

            <!-- Toast Notification -->
            <Border x:Name="ToastBorder" Grid.Row="2" VerticalAlignment="Top" HorizontalAlignment="Center" 
                    Background="#DD000000" CornerRadius="5" Padding="20,10" Margin="0,20,0,0" Visibility="Collapsed">
                <TextBlock x:Name="ToastText" Text="" FontSize="14" Foreground="#00FFFF" FontFamily="Consolas"/>
            </Border>
        </Grid>
    </Border>
</Window>
